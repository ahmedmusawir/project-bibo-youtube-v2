# 06 — Project Data Model

Complete reference for the project folder structure, file naming conventions, approval state, and data lifecycle.

---

## Project Root Structure

```
project-bibo-youtube-v2/          # App root
├── app/                          # Streamlit UI layer
├── src/                          # Pipeline modules
├── config/
│   └── config.json               # Runtime model/voice configuration
├── credentials/
│   └── cyberize-vertex-api.json  # Google Cloud service account (gitignored)
├── projects/                     # All video production projects (gitignored)
│   ├── MyProject1/
│   ├── MyProject2/
│   └── ...
├── tools/                        # Windows deployment tools (gitignored)
│   ├── ffmpeg/                   # ffmpeg.exe, ffplay.exe, ffprobe.exe
│   └── python/                   # Embeddable Python 3.12.3
├── logs/                         # Runtime log files (gitignored)
├── .env                          # Environment variables (gitignored)
├── .env.example                  # Template for .env
├── requirements.txt              # Python dependencies
├── INSTALL.bat                   # Windows one-time setup script
├── START.bat                     # Windows daily launcher
└── WINDOWS_SETUP.md              # Windows deployment guide
```

---

## Single Project Folder Structure

Every project lives under `projects/<project_name>/`. All pipeline stages read from and write to this folder.

```
projects/MyProject/
├── config.json               # Approval state (created by create_project())
├── 0_transcript.txt          # Stage 0: Raw transcript (from YouTube or pasted text)
├── 1_summary.txt             # Stage 1: Generated YouTube script (~900 words)
├── 2_audio.mp3               # Stage 2: TTS narration audio
├── 3_image_prompts.json      # Stage 4a: Numbered image prompts (JSON array)
├── 3a_style_bible.txt        # Stage 4a: Visual Style Bible (auto-generated, editable)
├── 4_metadata.json           # Stage 3: YouTube metadata (titles, description, hashtags)
├── 5_images/                 # Stage 4b: AI-generated PNG images
│   ├── 001.png
│   ├── 002.png
│   ├── ...
│   └── _image_log.json       # Log of prompts used for each image
└── 6_final_video.mp4         # Stage 5: Final composed video
```

---

## File Specifications

### `config.json`
```json
{
  "project_name": "MyProject",
  "approvals": {
    "script": false,
    "audio": false,
    "metadata": false,
    "images": false,
    "video": false
  }
}
```
- Created by `app/state.py:create_project()`
- Updated by `app/state.py:set_approval()`
- Read by every page to determine gate status

---

### `0_transcript.txt`
- **Source A:** Pasted text saved directly from the Inputs page
- **Source B:** Google Cloud STT output from YouTube audio transcription
- **Format:** Plain text, UTF-8
- **Typical size:** 3,000–15,000 words for a YouTube video
- **Used by:** `src/summarization.py` (loaded via `TextLoader`)

---

### `1_summary.txt`
- **Generated by:** `src/summarization.py` via Gemini LLM
- **Format:** Plain text, UTF-8, no special characters (`*`, `#`, etc.)
- **Target length:** 920–950 words
- **Must end with:** "Thanks for watching"
- **Used by:** `src/text_to_speech.py`, `src/metadata_generation.py`, `src/image_prompting.py`
- **Editable:** Yes — via Script page edit mode in the UI

---

### `2_audio.mp3`
- **Generated by:** `src/text_to_speech.py` via Google Cloud TTS
- **Format:** MP3, variable bitrate
- **Typical duration:** 5–7 minutes (for ~900 word script at ~150 wpm)
- **Used by:** `src/image_prompting.py` (for timing calculation), `src/video_composition.py`

---

### `3_image_prompts.json`
- **Generated by:** `src/image_prompting.py`
- **Format:** Plain text file (despite `.json` extension) — numbered list format:
  ```
  1. Photorealistic image of...
  2. High-resolution scene showing...
  ```
- **Count:** `ceil(audio_duration_seconds / 20)` — one prompt per 20 seconds of audio
- **Used by:** `src/image_creation.py`
- **Editable:** Yes — prompts can be manually edited before image generation

---

### `3a_style_bible.txt`
- **Generated by:** `src/image_prompting.py:_generate_style_bible()`
- **Format:** Plain text, 3–5 sentences (~60–80 words)
- **Content:** Visual style description only — color palette, lighting, camera perspective, texture, cinematic tone. No content or story.
- **Lifecycle:** Generated once per project. If file exists and is non-empty, it is reused (not regenerated). This allows manual editing.
- **Used by:** Injected as context into every individual image prompt generation call

---

### `4_metadata.json`
- **Generated by:** `src/metadata_generation.py`
- **Format:** JSON
  ```json
  {
    "titles": ["Title 1", "Title 2", "Title 3", "Title 4", "Title 5"],
    "description": "Full YouTube description text...",
    "hashtags": ["#tag1", "#tag2", "#tag3"]
  }
  ```
- **Titles:** 5 SEO-optimized options
- **Description:** 100–300 words
- **Hashtags:** 5–10 tags starting with `#`

---

### `5_images/`
- **Generated by:** `src/image_creation.py` via Vertex AI Imagen
- **Format:** PNG, 16:9 aspect ratio
- **Naming:** Zero-padded index: `001.png`, `002.png`, ..., `NNN.png`
- **Sorting:** `video_composition.py` sorts images alphabetically — zero-padding ensures correct order
- **Also contains:** `_image_log.json` — maps each image index to its prompt and filepath
- **Used by:** `src/video_composition.py`

---

### `6_final_video.mp4`
- **Generated by:** `src/video_composition.py` via MoviePy
- **Format:** MP4, H.264 video + AAC audio
- **Resolution:** 1920×1080 (Full HD)
- **Frame rate:** 24 fps
- **Effects:** Ken Burns zoom (5% over clip duration), fade-in/fade-out (1.5s each)
- **Duration:** Matches `2_audio.mp3` duration exactly (images are auto-timed to fill audio)

---

## Stage-to-File Mapping (from `app/state.py`)

```python
stage_files = {
    "script":   "1_summary.txt",
    "audio":    "2_audio.mp3",
    "metadata": "4_metadata.json",
    "images":   "5_images",        # directory — checked for non-empty
    "video":    "6_final_video.mp4"
}
```

Note: `0_transcript.txt` is not tracked as a named stage in the approval system. Its existence is checked directly by the Script page.

---

## Data Lifecycle

### Creation
- `create_project(name)` creates the directory and `config.json`
- Each pipeline stage creates its output file when the user clicks the generate button

### Regeneration
- Any stage can be regenerated from its page
- Regenerating a stage resets its approval status to `false`
- Downstream stage files are NOT automatically deleted — they remain until explicitly regenerated

### Deletion
- No automatic deletion in the current system
- To fully reset a project: delete the project folder from `projects/`
- Individual stage files can be deleted manually to force regeneration

### Persistence
- All project data persists on disk — survives server restarts, browser refreshes
- Only `st.session_state` (process logs, UI state) is lost on restart

---

## Project Naming Conventions

- Project names become directory names — avoid special characters
- Spaces are technically allowed but underscores are recommended: `BBC_Robots`, `60min_AI`
- Names are case-sensitive on Linux, case-insensitive on Windows (filesystem dependent)
- The UI sorts projects alphabetically in the dropdown

---

## `projects/` Directory — Git Status

The `projects/` directory is **gitignored**. Project data is never committed to the repository. This is intentional:
- Projects contain generated content (audio, images, video) that is too large for git
- Projects may contain proprietary content
- Each deployment maintains its own independent project history
